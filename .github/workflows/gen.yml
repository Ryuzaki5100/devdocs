name: Generate Documentation

on:
  push:
    branches:
      - '*'

jobs:
  generate-docs:
    runs-on: windows-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Install curl
        run: |
          if not exist "curl-install" mkdir curl-install
          cd curl-install
          
          powershell -Command "Invoke-WebRequest -Uri 'https://curl.se/windows/dl-8.4.0_7/curl-8.4.0_7-win64-mingw.zip' -OutFile 'curl.zip'"
          powershell -Command "Expand-Archive -Path 'curl.zip' -DestinationPath ."

          for /d %%D in (curl-*-win64-mingw) do set "CURL_DIR=%%D"
          move "!CURL_DIR!\bin\curl.exe" "%GITHUB_WORKSPACE%"
          
          cd %GITHUB_WORKSPACE%
          rmdir /s /q curl-install

          echo %GITHUB_WORKSPACE%>> %GITHUB_PATH%
        shell: cmd

      - name: Generate java_files.txt
        run: batch_files\generateFileStructure.bat
        shell: cmd

      - name: Process java_files.txt and Generate JSON
        run: batch_files\generateChunks.bat
        shell: cmd
        env:
          GH_OWNER: ${{ github.repository_owner }}
          GH_REPO: ${{ github.repository }}
          GH_BRANCH: ${{ github.ref_name }}

      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
        shell: cmd

      - name: Commit Generated Files
        run: |
          cd batch_files
          git add java_files.txt
          git add *.json
          git diff --staged --quiet || git commit -m "Auto-generate java_files.txt and JSON [skip ci]"
          git push
        shell: cmd
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
