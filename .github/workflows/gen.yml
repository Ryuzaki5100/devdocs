name: Generate Documentation

on:
  push:
    branches:
      - develop

jobs:
  generate-docs:
    runs-on: windows-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Install curl
        run: |
          mkdir curl-install
          cd curl-install
          powershell -Command "Invoke-WebRequest -Uri 'https://curl.se/windows/dl-8.4.0_7/curl-8.4.0_7-win64-mingw.zip' -OutFile 'curl.zip'"
          powershell -Command "Expand-Archive -Path 'curl.zip' -DestinationPath ."
          move curl-*-win64-mingw\bin\curl.exe %GITHUB_WORKSPACE%
          cd %GITHUB_WORKSPACE%
          rmdir /s /q curl-install
          echo %GITHUB_WORKSPACE%>> %GITHUB_PATH%
        shell: cmd

      - name: Generate java_files.txt
        run: batch_files\generateFileStructure.bat
        shell: cmd

      - name: Process java_files.txt and Generate JSON
        run: |
          cd batch_files
          call setEnv.bat
          call generateChunks.bat
        shell: cmd

      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
        shell: cmd

      - name: Commit Generated Files
        run: |
          cd batch_files
          git add java_files.txt
          git add *.json
          git diff --staged --quiet || git commit -m "Auto-generate java_files.txt and JSON [skip ci]"
          git push
        shell: cmd
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
